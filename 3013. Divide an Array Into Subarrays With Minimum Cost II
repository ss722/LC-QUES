class Solution {
public:
    long long minimumCost(vector<int>& nums, int k, int dist) {
        set<pair<int,int>,greater<pair<int,int>>> small;
        set<pair<int,int>> large;
        long long ans = nums[0];
        long long minsum = LONG_MAX;
        int n=nums.size();
        for(int i=1;i<=dist+1 && i<nums.size();i++){
            large.insert({nums[i],i});
        }
        long long currsum =0;
        for(int i=1;i<k;i++){
            auto it = large.begin();
            int val = it->first;
            int ind= it->second;
            small.insert({val,ind});
            large.erase({val,ind});
            currsum += val;
        }
        minsum = min(minsum,currsum);

        for(int i=2;i<nums.size()-k+2;i++){
            if(small.count({nums[i-1],i-1})>0){
                currsum-=nums[i-1];
                small.erase({nums[i-1],i-1});
            }
            else{
                large.erase({nums[i-1],i-1});
            }
            int end = i+dist;
            if(end <= n-1) {
                large.insert({nums[end],end});
            }
            
            if(small.size()<k-1 ){
                auto it = large.begin();
                currsum += it->first;
                small.insert(*it);
                large.erase(it);
            }
            else if(!large.empty() && large.begin()->first < small.begin()->first){
                auto it1 = large.begin();
                auto it2 = small.begin();
                currsum-= it2->first;
                currsum+= it1->first;
                small.insert(*it1);
                large.insert(*it2);
                small.erase(it2);
                large.erase(it1);
            }
            
            minsum = min(minsum,currsum);
        }
        return ans+minsum;
    }
};

